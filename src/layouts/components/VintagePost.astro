---
const { bookTitle, author, hashTag, chapterTitle, image,
  intro, main,
  commentBefore, commentAfter,
  verse, verseTranslated, verseExtra, verseExtraTranslated,
  content1,
  content2,
  content3,
  content4,
  content5,
  content6,
  content7,
  content8,
  content9,
  content10,
  content11,
  content12,
  content13,
  content14,
  content15,
  content16,
  content17,
} = Astro.props;

const contents = [
  content1,
  content2,
  content3,
  content4,
  content5,
  content6,
  content7,
  content8,
  content9,
  content10,
  content11,
  content12,
  content13,
  content14,
  content15,
  content16,
  content17,
];
---

<script>
  let handleTextAnimation = (texts, observer) => {
    texts.forEach(text => {
      if (text.isIntersecting) {
        text.target.classList.add('visible');
      }
      else {
        text.target.classList.remove('visible');
      }
    });
  };

  const texts = document.querySelectorAll("p, .storyImage, h1, h2");

  texts.forEach(text => {
    let textObserver = new IntersectionObserver(handleTextAnimation);
    textObserver.observe(text);
  })
</script>

<article id="story" class="story">
  <header class="story__header" style={`background-image: url(${image})`}>
    <h1 class="story__title"> {bookTitle}
      <span class="story__byline">{author}</span>
    </h1>

  </header>
  <section class="chapter">
    <header class="chapter__header">
      <h2 class="chapter__title" id={hashTag}>{chapterTitle}</h2>
    </header>
    <div class="chapter__contents">
      <div class="two-column">
        <p>{intro}</p>
        <!--<span class="storyImage" style={`background-image: url(${image})`}></span>-->
      </div>

      {
        main
          ? <h4>CÔNG ÁN</h4>
            <p>{main}</p>
            <hr/>
          : ''
      }

      <p>{
        commentBefore ? commentBefore : ''
      }</p>

      {
        contents?.length
          ? contents?.map(content => <p>{content}</p>)
          : ''
      }

      {
        verse
          ? <hr/>
          <h4>TỤNG</h4>
          <p>{verse}</p>
          : ''
      }

      {
        verseTranslated
          ? <hr/>
          <h4>DỊCH TỤNG</h4>
          <p>{verseTranslated}</p>
          : ''
      }

      {
        verseExtra && verseExtraTranslated
        ? <hr/>
          <h4>TỤNG</h4>
          <p>{verseExtra}</p>
          <hr/>

          <h4>DỊCH TỤNG</h4>
          <p>{verseExtraTranslated}</p>
          <hr/>
        : ''
      }

      {
        commentAfter
          ? <h4>BÌNH</h4>
            <p>{commentAfter}</p>
          : ''
      }

      <p class="chapter__end">~</p>
    </div>
  </section>
</article>

<style>
  :root {
    --red: #5d0c08;
    --newRed: #ff0000
    --mq: 768px;
  }

  html,
  body {
    font-family: 'IM Fell French Canon', serif;
    scroll-behavior: smooth;
    letter-spacing: 1px;
    /*background-image: url("https://assets.codepen.io/618359/paper.jpg");*/
    background-size: contain;
  }

  .story {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .story__header {
    display: flex;
    width: 100%;
    height: 740px;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-size: cover;
    background-repeat: no-repeat;
  }

  .story__title {
    font-size: 70px;
    text-transform: uppercase;
    color: var(--newRed);
  }

  .story__title:first-letter {
    font-size: 113px;
    float: left;
    line-height: 0.75;
  }

  @media (min-width: var(--mq)) {
    .story__title {
      font-size: 124px;
    }
    .story__title:first-letter {
      font-size: 200px;
    }
  }

  .story__byline {
    display: block;
    font-size: 18px;
    text-transform: initial;
    margin-left: 112px;
    font-style: italic;
  }

  @media (min-width: var(--mq)) {
    .story__byline {
      margin-left: 156px;
      font-size: 32px;
    }
  }

  .chapter__header {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    padding: 40px 0;
  }

  .chapter__title {
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    font-size: 36px;
    text-align: center;
    color: var(--red);
  }

  .chapter__title:before,
  .chapter__title:after {
    content: "";
    width: 50px;
    height: 2px;
    margin: 0 10px;
    background-color: var(--red);
    transition: all 1s ease-in-out;
    transform: scaleX(0.0);
    opacity: 0;
  }

  .chapter__title:before {
    transform-origin: right;
  }

  .chapter__title:after {
    transform-origin: left;
  }

  .chapter__title.visible:before,
  .chapter__title.visible:after {
    transform: scaleX(1);
    opacity: 1;
  }

  .chapter__contents {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
  }

  .chapter__end {
    font-size: 64px;
    color: var(--red);
    text-align: center;
    font-weight: bold;
  }

  .two-column {
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr 1fr;
  }

  .two-column:nth-child(1),
  .two-column:nth-child(2) {
    height: 100%;
  }

  @media (min-width: var(--mq)) {
    .two-column {
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr;
    }
  }

  p {
    max-width: 600px;
    padding-top: 30px;
    font-size: 20px;
    line-height: 1.5;
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.6s ease;
  }

  p:first-of-type:first-letter {
    font-size: 200%;
    font-weight: bold;
    color: var(--red);
  }

  p.visible {
    transform: translateY(0);
    opacity: 1;
  }

  .storyImage {
    display: block;
    background-repeat: no-repeat;
    background-position: 0 0;
    background-size: 9600px 216px;
  }

  .storyImage.visible {
    animation: animateImage 1.1s steps(24) forwards;
    animation-delay: 1s;
  }

  @media (min-width: var(--mq)) {
    .storyImage {
      background-size: 16000px 360px;
    }
  }

  @keyframes animateImage {
    from {
      background-position: 0 50%;
      opacity: 0.5;
    }
    to {
      background-position: 100% 50%;
      opacity: 1;
    }
  }

</style>
