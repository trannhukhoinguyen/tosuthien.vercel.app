---
const { title, content } = Astro.props;
---

<script>
  let handleTextAnimation = (texts, observer) => {
    texts.forEach(text => {
      if (text.isIntersecting) {
        text.target.classList.add('visible');
      }
      else {
        text.target.classList.remove('visible');
      }
    });
  };

  const texts = document.querySelectorAll("p, .storyImage, h1, h2");

  texts.forEach(text => {
    let textObserver = new IntersectionObserver(handleTextAnimation);
    textObserver.observe(text);
  })
</script>

<article id="story" class="story">
  <header class="story__header">
    <h1 class="story__title"> Redwall
      <span class="story__byline">by Brian Jacques</span>
    </h1>

  </header>
  <section class="chapter">
    <header class="chapter__header">
      <h2 class="chapter__title">
        Chapter 1
      </h2>
    </header>
    <div class="chapter__contents">
      <div class="two-column">
        <p>Matthias cut a comical little figure as he wobbled his way along the cloisters, with his large sandals flip-flopping and his tail peeping from beneath the baggy folds of an oversized novice's habit. He paused to gaze upwards at the cloudless blue sky and tripped over the enormous sandals. Hazelnuts scattered out upon the grass from the rush basket he was carrying. Unable to stop, he went tumbling cowl over tail.</p>
        <span class="storyImage" style="background-image: url(https://assets.codepen.io/618359/ch1-1-effect.png)"></span>
      </div>

      <p>Bump!</p>

      <p>The young mouse squeaked in dismay. He rubbed tenderly at his damp snub nose while slowly taking stock of where he had landed: directly at the feet of Abbot Mortimer!</p>

      <p class="chapter__end">~</p>
    </div>
  </section>
</article>

<style>
  :root {
    --red: #5d0c08;
    --mq: 768px;
  }

  * {
    box-sizing: border-box;
  }

  html,
  body {
    font-family: 'IM Fell French Canon', serif;
    scroll-behavior: smooth;
    letter-spacing: 1px;
    background-image: url("https://assets.codepen.io/618359/paper.jpg");
    background-size: contain;
  }

  .story {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .story__header {
    display: flex;
    width: 100%;
    height: 740px;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-image: url(https://assets.codepen.io/618359/redwall-bg.jpg);
    background-size: cover;
    background-repeat: no-repeat;
  }

  .story__title {
    font-size: 70px;
    text-transform: uppercase;
    color: var(--red);
  }

  .story__title:first-letter {
    font-size: 113px;
    float: left;
    line-height: 0.75;
  }

  @media (min-width: var(--mq)) {
    .story__title {
      font-size: 124px;
    }
    .story__title:first-letter {
      font-size: 200px;
    }
  }

  .story__byline {
    display: block;
    font-size: 18px;
    text-transform: initial;
    margin-left: 112px;
    font-style: italic;
  }

  @media (min-width: var(--mq)) {
    .story__byline {
      margin-left: 156px;
      font-size: 32px;
    }
  }

  .chapter__header {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    padding: 40px 0;
  }

  .chapter__title {
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    font-size: 36px;
    text-align: center;
    color: var(--red);
  }

  .chapter__title:before,
  .chapter__title:after {
    content: "";
    width: 50px;
    height: 2px;
    margin: 0 10px;
    background-color: var(--red);
    transition: all 1s ease-in-out;
    transform: scaleX(0.0);
    opacity: 0;
  }

  .chapter__title:before {
    transform-origin: right;
  }

  .chapter__title:after {
    transform-origin: left;
  }

  .chapter__title.visible:before,
  .chapter__title.visible:after {
    transform: scaleX(1);
    opacity: 1;
  }

  .chapter__contents {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
  }

  .chapter__end {
    font-size: 64px;
    color: var(--red);
    text-align: center;
    font-weight: bold;
  }

  .two-column {
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr 1fr;
  }

  .two-column:nth-child(1),
  .two-column:nth-child(2) {
    height: 100%;
  }

  @media (min-width: var(--mq)) {
    .two-column {
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr;
    }
  }

  p {
    max-width: 600px;
    padding-top: 30px;
    font-size: 20px;
    line-height: 1.5;
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.6s ease;
  }

  p:first-of-type:first-letter {
    font-size: 200%;
    font-weight: bold;
    color: var(--red);
  }

  p.visible {
    transform: translateY(0);
    opacity: 1;
  }

  .storyImage {
    display: block;
    background-repeat: no-repeat;
    background-position: 0 0;
    background-size: 9600px 216px;
  }

  .storyImage.visible {
    animation: animateImage 1.1s steps(24) forwards;
    animation-delay: 1s;
  }

  @media (min-width: var(--mq)) {
    .storyImage {
      background-size: 16000px 360px;
    }
  }

  @keyframes animateImage {
    from {
      background-position: 0 50%;
      opacity: 0.5;
    }
    to {
      background-position: 100% 50%;
      opacity: 1;
    }
  }

</style>
